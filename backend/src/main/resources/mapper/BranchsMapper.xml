<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.apple.arentcar.mapper.BranchsMapper">
    <select id="findAllBranches" resultType="com.apple.arentcar.model.Branchs">
        SELECT * FROM branchs
    </select>

    <select id="findBranchsByBranchName" resultType="com.apple.arentcar.model.Branchs">
        SELECT * FROM branchs
        WHERE branch_name LIKE CONCAT('%', #{branchname}, '%')
    </select>

    <select id="getBranchChartData" resultType="com.apple.arentcar.dto.ChartDataDTO">
        SELECT b.branch_name AS branchName , COUNT(r.reservation_code) as reservationCode
        FROM reservations r
        LEFT JOIN branchs b ON r.rental_location = b.branch_code
        WHERE r.rental_date BETWEEN #{startDate} AND #{endDate}
        GROUP BY b.branch_name
        order by reservationCode DESC
        LIMIT 5;
    </select>

    <!-- 전체 지점 수 조회 -->
    <select id="countAllBranchs" resultType="int">
        SELECT COUNT(*) FROM branchs;
    </select>


    <!-- 지점 조회 및 페이지네이션 -->
    <select id="getBranchsWithPaging" resultType="com.apple.arentcar.dto.BranchsSearchDTO">
        SELECT
            b.branch_code AS branchCode,
            b.branch_name AS branchName,
            b.region_code AS regionCode,
            b.post_code AS postCode,
            b.branch_detailed_address AS branchDetailedAddress,
            b.available_pickup_time AS availablePickupTime,
            b.available_return_time AS availableReturnTime,
            b.created_at AS createdAt,
            b.updated_at AS updatedAt
        FROM branchs b
        ORDER BY b.branch_code LIMIT #{pageSize} OFFSET #{offset}
    </select>

    <!-- 지점 조회 및 페이지네이션(검색 기능 포함) -->
    <select id="getBranchsByNameWithPaging" resultType="com.apple.arentcar.dto.BranchsSearchDTO">
        SELECT
            b.branch_code AS branchCode,
            b.branch_name AS branchName,
            b.region_code AS regionCode,
            b.post_code AS postCode,
            b.branch_detailed_address AS branchDetailedAddress,
            b.available_pickup_time AS availablePickupTime,
            b.available_return_time AS availableReturnTime,
            b.created_at AS createdAt,
            b.updated_at AS updatedAt
        FROM branchs b
        WHERE b.branch_name LIKE CONCAT('%', #{branchName}, '%')
        ORDER BY b.branch_code
        LIMIT #{pageSize} OFFSET #{offset}
    </select>



</mapper>
